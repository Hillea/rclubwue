{
  "hash": "e938a2d4e39a30d5c7547c54190782c9",
  "result": {
    "markdown": "---\ntitle: \"Data Visualization\"\nsubtitle: |\n   | R Coding Club \n   | RTG 2660\nauthor: \"Dr. Lea Hildebrandt\"\ndate: 2024/03/05\ndescription: \"Making the first plots\"\nformat: \n  revealjs:\n    smaller: true\n    scrollable: true\n    slide-number: true\n    theme: simple\n    chalkboard: true\neditor: visual\nfrom: markdown+emoji\n---\n\n\n# Warm-up\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n<style type=\"text/css\">\ncode.sourceCode {\n  font-size: 1.4em;\n}\n\ndiv.cell-output-stdout {\n  font-size: 1.4em;\n}\n</style>\n:::\n\n\nAny problems?\n\n. . .\n\nImagine you have the following data frame/tibble with animal names, and you want to print to the console the name of the animal and the sound it makes, such as \"The dog barks\" - but for all animals, one per row. How would you do this?\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf <- tibble(\n  animal = c(\"dog\", \"cat\", \"cow\")\n)\n```\n:::\n\n\n# Data Viz\n\nWhy should we visualize our data?\n\n::: incremental\n-   check whether data make sense (unusual observations?)\n\n-   honestly present the data\n\n-   check whether data fits the assumptions of statistical tests\n:::\n\n. . .\n\nIt's fun! (And plots are probably the most important information in papers!)\n\n## ggplot\n\nWe will use a package called `ggplot2` (which is part of the tidyverse). ggplot2 is a very versatile package and allows us to make beautiful, publication ready figures.\n\nThe main function to \"start\" plotting is `ggplot()` - we will then add layers of data and layers to tweak the appearance.\n\n![Layers of a ggplot](images/ggplotlayers.PNG){fig-alt=\"Depiction of how a plot is built up from different layers in ggplot2\" width=\"502\"}\n\n## Activity 1: Set Up\n\n1.  Download [`ahi-cesd.csv`](https://psyteachr.github.io/quant-fun-v2/ahi-cesd.csv) and [`participant-info.csv`](https://psyteachr.github.io/quant-fun-v2/participant-info.csv) into the folder on your computer for this chapter!\n\n2.  Open RStudio and set the working directory to your chapter folder. Ensure the environment is clear.\n\n3.  Open a **new R Markdown document** and save it in your working directory. Call the file \"DataVisualisation1\".\n\n4.  Delete the default R Markdown welcome text and insert a new code chunk.\n\n5.  **Load the data** into your environment and **join** the two datasets. Keep only the columns `ahiTotal, cesdTotal, sex, age, educ, income, occasion, elapsed.days.`\n\n. . .\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse) \n\ndat <- read_csv(\"Data/ahi-cesd.csv\")\npinfo <- read_csv(\"Data/participant-info.csv\")\n\nall_dat <- inner_join(dat, \n                      pinfo, \n                      by= c(\"id\", \"intervention\"))\n\nsummarydata <- select(.data = all_dat, \n                      ahiTotal, \n                      cesdTotal, \n                      sex, \n                      age, \n                      educ, \n                      income, \n                      occasion, \n                      elapsed.days) \n```\n:::\n\n::: {.cell}\n\n:::\n\n\n::: notes\nwhat happens in the code chunk?\n:::\n\n## Look at the Data\n\nHave a look at the types of data:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nglimpse(summarydata)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 992\nColumns: 8\n$ ahiTotal     <dbl> 32, 34, 34, 35, 36, 37, 38, 38, 38, 38, 39, 40, 41, 41, 4…\n$ cesdTotal    <dbl> 50, 49, 47, 41, 36, 35, 50, 55, 47, 39, 45, 47, 33, 27, 3…\n$ sex          <dbl> 1, 1, 1, 1, 1, 1, 2, 1, 2, 2, 1, 2, 1, 2, 2, 1, 1, 1, 1, …\n$ age          <dbl> 46, 37, 37, 19, 40, 49, 42, 57, 41, 41, 52, 41, 52, 58, 5…\n$ educ         <dbl> 4, 3, 3, 2, 5, 4, 4, 4, 4, 4, 5, 4, 5, 5, 5, 4, 3, 4, 3, …\n$ income       <dbl> 3, 2, 2, 1, 2, 1, 1, 2, 1, 1, 2, 1, 3, 2, 2, 3, 2, 2, 2, …\n$ occasion     <dbl> 5, 2, 3, 0, 5, 0, 2, 2, 2, 4, 4, 0, 4, 0, 1, 4, 0, 5, 4, …\n$ elapsed.days <dbl> 182.025139, 14.191806, 33.033831, 0.000000, 202.096887, 0…\n```\n:::\n:::\n\n\nWhat do you see?\n\n. . .\n\nAll variables are loaded as numeric. However, are all of those numeric?\n\n. . .\n\n`sex`, `educ` and `income` are categories, not numbers per se. We call these variables **factors**! We need to correct R and convert the data type to factor. Checking and adjusting the data types will be important for plotting and analyzing the data, you might otherwise get strange/wrong results!\n\n**How would you convert them to factors?**\n\n## Activity 2: Transform Data Type\n\nType and run the below code to change the categories to factors.\n\n-   You can read each line of the mutate as \"overwrite the data that is in that column with the same values now considered factors and not doubles\"\n\n-   So for example, the 1s in `sex` change to categorical factors instead of numerical 1s.\n\n-   Remember if you mutate a new column with the same name as the old one, it will overwrite the column.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummarydata <- summarydata %>%\n  mutate(sex = as_factor(sex),\n         educ = as_factor(educ),\n         income = as_factor(income))\n\nglimpse(summarydata)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 992\nColumns: 8\n$ ahiTotal     <dbl> 32, 34, 34, 35, 36, 37, 38, 38, 38, 38, 39, 40, 41, 41, 4…\n$ cesdTotal    <dbl> 50, 49, 47, 41, 36, 35, 50, 55, 47, 39, 45, 47, 33, 27, 3…\n$ sex          <fct> 1, 1, 1, 1, 1, 1, 2, 1, 2, 2, 1, 2, 1, 2, 2, 1, 1, 1, 1, …\n$ age          <dbl> 46, 37, 37, 19, 40, 49, 42, 57, 41, 41, 52, 41, 52, 58, 5…\n$ educ         <fct> 4, 3, 3, 2, 5, 4, 4, 4, 4, 4, 5, 4, 5, 5, 5, 4, 3, 4, 3, …\n$ income       <fct> 3, 2, 2, 1, 2, 1, 1, 2, 1, 1, 2, 1, 3, 2, 2, 3, 2, 2, 2, …\n$ occasion     <dbl> 5, 2, 3, 0, 5, 0, 2, 2, 2, 4, 4, 0, 4, 0, 1, 4, 0, 5, 4, …\n$ elapsed.days <dbl> 182.025139, 14.191806, 33.033831, 0.000000, 202.096887, 0…\n```\n:::\n:::\n\n\n# Activity 3: Barplot\n\nWhat is a barplot? How does it look like and when would you use it?\n\n. . .\n\nA bar plot is a plot that shows counts of categorical data (factors), where the height of each bar represents the count of that variable.\n\nWe will plot male and female participants.\n\n## The First Layer\n\n-   The first line (or layer) sets up the base of the graph: the data to use and the aesthetics (what will go on the x and y axis, how the plot will be grouped).\n\n-   `aes()` can take both an `x` and `y` argument, however, with a bar plot you are just asking R to count the number of data points in each group so you don't need to specify this.\n\n\n::: {.cell output-location='column-fragment'}\n\n```{.r .cell-code}\nggplot(summarydata, aes(x = sex))\n```\n\n::: {.cell-output-display}\n![](W3b_DataVizR_files/figure-revealjs/unnamed-chunk-8-1.png){width=960}\n:::\n:::\n\n\n## The Second Layer\n\nThe next layer adds a **geom** or a shape, in this case we use `geom_bar()` as we want to draw a bar plot.\n\n-   Note that we are adding layers, using a [`+`](https://rdrr.io/r/base/Arithmetic.html) between layers. This is a very important difference between pipes and visualization.\n\n\n::: {.cell output-location='column-fragment'}\n\n```{.r .cell-code  code-line-numbers=\"2\"}\nggplot(summarydata, aes(x = sex)) +\n  geom_bar()\n```\n\n::: {.cell-output-display}\n![](W3b_DataVizR_files/figure-revealjs/unnamed-chunk-9-1.png){width=960}\n:::\n:::\n\n\n. . .\n\n-   Adding `fill` to the first layer will separate the data into each level of the grouping variable and give it a different colour. In this case, there is a different coloured bar for each level of `sex`.\n\n-   We can get rid of the (in this case redundant legend) with `show.legend = FALSE`.\n\n\n::: {.cell output-location='column-fragment'}\n\n```{.r .cell-code  code-line-numbers=\"1|2\"}\nggplot(summarydata, aes(x = sex, fill = sex)) +\n  geom_bar(show.legend = FALSE)\n```\n\n::: {.cell-output-display}\n![](W3b_DataVizR_files/figure-revealjs/unnamed-chunk-10-1.png){width=960}\n:::\n:::\n\n\n## The Next Layers - Improving the Plot\n\nWe might want to make the plot a bit prettier and easier to read. What would you improve?\n\n. . .\n\nWe might want to add better axis labels and change the colors of the bars. We can do so with the functions `scale_x_discrete()` and `scale_y_continuous()`, which will adjust the x and y axes.\n\nWe will use these two arguments in those functions:\n\n-   `name` controls/overwrites the axis name (e.g. Groups)\n\n-   `labels` controls the break points on the axis, i.e. what are the conditions called? The order is important here!\n\n\n::: {.cell output-location='column-fragment'}\n\n```{.r .cell-code  code-line-numbers=\"3,4|5\"}\nggplot(summarydata, aes(x = sex, fill = sex)) +\n  geom_bar(show.legend = FALSE) +\n  scale_x_discrete(name = \"Participant Sex\", \n                   labels = c(\"Female\", \"Male\")) +\n  scale_y_continuous(name = \"Number of participants\")\n```\n\n::: {.cell-output-display}\n![](W3b_DataVizR_files/figure-revealjs/unnamed-chunk-11-1.png){width=960}\n:::\n:::\n\n\n::: notes\nThere's also the counterparts `scale_x_continuous()` and `scale_y_discrete()`. What do you think, why do we use the ones mentioned above and when would we use the other ones?\n:::\n\n## Themes: Changing the Appearance\n\nThere are a number of built-in themes that you can use to change the appearance (background, whether axes are shown etc.), but you can also tweak the themes further manually.\n\nWe will now change the default theme to `theme_minimal()`, but you can also try other themes (just type \"theme\\_\" and see what the autocomplete brings up).\n\n\n::: {.cell output-location='column-fragment'}\n\n```{.r .cell-code  code-line-numbers=\"6\"}\nggplot(summarydata, aes(x = sex, fill = sex)) +\n  geom_bar(show.legend = FALSE) +\n  scale_x_discrete(name = \"Participant Sex\", \n                   labels = c(\"Female\", \"Male\")) +\n  scale_y_continuous(name = \"Number of participants\") +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](W3b_DataVizR_files/figure-revealjs/unnamed-chunk-12-1.png){width=960}\n:::\n:::\n\n\n## Colors\n\nThere are various ways to change the colors of the bars. You can manually indicate the colors you want to use but you can also easily use pre-determined color palettes that are already checked for color-blind friendliness.\n\nA popular palette is **viridis**. We can simply add a function/layer to your ggplot named `scale_fill_viridis_d()` (d for discrete). The function hast 5 color options (A - E).\n\n-   Type and run the below code into a new code chunk. Try changing the option to either A, B, C or D and see which one you like!\n\n\n::: {.cell output-location='column-fragment'}\n\n```{.r .cell-code  code-line-numbers=\"7\"}\nggplot(summarydata, aes(x = sex, fill = sex)) +\n  geom_bar(show.legend = FALSE) +\n  scale_x_discrete(name = \"Participant Sex\", \n                   labels = c(\"Female\", \"Male\")) +\n  scale_y_continuous(name = \"Number of participants\") +\n  theme_minimal() +\n  scale_fill_viridis_d(option = \"E\")\n```\n\n::: {.cell-output-display}\n![](W3b_DataVizR_files/figure-revealjs/unnamed-chunk-13-1.png){width=960}\n:::\n:::\n\n\n## Transparency\n\nYou can also add transparency to your plot, which can be helpful if you plot several layers of data.\n\nTo do so, you can simply add `alpha` to the `geom_bar()`:\n\n\n::: {.cell output-location='column-fragment'}\n\n```{.r .cell-code  code-line-numbers=\"3\"}\nggplot(summarydata, aes(x = sex, fill = sex)) +\n  geom_bar(show.legend = FALSE, \n           alpha = .8) +\n  scale_x_discrete(name = \"Participant Sex\", \n                   labels = c(\"Female\", \"Male\")) +\n  scale_y_continuous(name = \"Number of participants\") +\n  theme_minimal() +\n  scale_fill_viridis_d(option = \"E\")\n```\n\n::: {.cell-output-display}\n![](W3b_DataVizR_files/figure-revealjs/unnamed-chunk-14-1.png){width=960}\n:::\n:::\n\n\n## Grouped Plots\n\nLet's go back to the bar plot (but works similarly for other plots as well): Imagine that you have several *factors* that you want to use to group your data, such as gender and income. In this case, you could use a **grouped bar plot**:\n\n\n::: {.cell output-location='column-fragment'}\n\n```{.r .cell-code  code-line-numbers=\"1|2\"}\nggplot(summarydata, aes(x = sex, fill = income)) +\n  geom_bar(position = \"dodge\",\n           show.legend = TRUE, \n           alpha = .8) +\n  scale_x_discrete(name = \"Participant Sex\", \n                   labels = c(\"Female\", \"Male\")) +\n  scale_y_continuous(name = \"Number of participants\") +\n  theme_minimal() +\n  scale_fill_viridis_d(option = \"E\")\n```\n\n::: {.cell-output-display}\n![](W3b_DataVizR_files/figure-revealjs/unnamed-chunk-15-1.png){width=960}\n:::\n:::\n\n\n## Facetting\n\nYou could also use **facets** to divide your data visualizations:\n\n\n::: {.cell output-location='column-fragment'}\n\n```{.r .cell-code  code-line-numbers=\"9\"}\nggplot(summarydata, aes(x = sex, fill = sex)) +\n  geom_bar(show.legend = FALSE, \n           alpha = .8) +\n  scale_x_discrete(name = \"Participant Sex\", \n                   labels = c(\"Female\", \"Male\")) +\n  scale_y_continuous(name = \"Number of participants\") +\n  theme_minimal() +\n  scale_fill_viridis_d(option = \"E\")  +\n  facet_wrap(~income)\n```\n\n::: {.cell-output-display}\n![](W3b_DataVizR_files/figure-revealjs/unnamed-chunk-16-1.png){width=960}\n:::\n:::\n\n\nTry to switch sex and income!\n\n# Activity 4: The Violin-Boxplot\n\nThere are a number of different figure types you can plot with the different geoms, e.g. `geom_point()`, `geom_histogram()`, `geom_line()`...\n\nWe now want to plot a form of a boxplot that becomes more popular: The violin-boxplot (which combines- i.e. overlays - the violin plot with a boxplot).\n\n## Violin-Boxplot\n\nLet's look at the code. How does the code differ from the one for the barplot before?\n\n\n::: {.cell output-location='column-fragment'}\n\n```{.r .cell-code  code-line-numbers=\"|2|4|7\"}\nggplot(summarydata, aes(x = income, \n                        y = ahiTotal, \n                        fill = income)) +\n  geom_violin(trim = FALSE, \n              show.legend = FALSE, \n              alpha = .4) +\n  geom_boxplot(width = .2, \n               show.legend = FALSE, \n               alpha = .7)+\n  scale_x_discrete(name = \"Income\",\n                   labels = c(\"Below Average\", \n                              \"Average\", \n                              \"Above Average\")) +\n  scale_y_continuous(name = \"Authentic Happiness Inventory Score\")+\n  theme_minimal() +\n  scale_fill_viridis_d()\n```\n\n::: {.cell-output-display}\n![](W3b_DataVizR_files/figure-revealjs/unnamed-chunk-17-1.png){width=960}\n:::\n:::\n\n\n::: notes\nIn this case, not the **count** on the y-axis, but another cont. variable!\n:::\n\n## Layer Order\n\nThe order of layers is crucial, as the plot will be built up in that order:\n\n::: columns\n::: column\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(summarydata, aes(x = income, y = ahiTotal)) +\n  geom_violin() +\n  geom_boxplot()\n```\n\n::: {.cell-output-display}\n![](W3b_DataVizR_files/figure-revealjs/unnamed-chunk-18-1.png){width=960}\n:::\n:::\n\n:::\n\n::: column\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(summarydata, aes(x = income, y = ahiTotal)) +\n  geom_boxplot() +\n  geom_violin() \n```\n\n::: {.cell-output-display}\n![](W3b_DataVizR_files/figure-revealjs/unnamed-chunk-19-1.png){width=960}\n:::\n:::\n\n:::\n:::\n\n## Scatterplot\n\nIf we have continuous data of two variables, we often want to make a **scatter plot**:\n\n\n::: {.cell output-location='column-fragment'}\n\n```{.r .cell-code  code-line-numbers=\"1|2|5\"}\nggplot(summarydata, aes(x = age, y = cesdTotal))+\n  geom_point()+\n  geom_smooth(method=lm) # if you don't want the shaded CI, add se = FALSE to this\n```\n\n::: {.cell-output-display}\n![](W3b_DataVizR_files/figure-revealjs/unnamed-chunk-20-1.png){width=960}\n:::\n:::\n\n\n## Saving your Figures\n\nYou can use `ggsave()` to save your plots. If you don't tell `ggsave()` which plot you want to save, by default it will save **the last plot you created**.\n\nYou just have to enter the name of the file to be saved (in your working directory) like this:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggsave(\"violin-boxplot.png\")\n```\n:::\n\n\nCheck whether indeed the last plot was saved!\n\n. . .\n\nYou can also specify the dimensions of your plot to be saved:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggsave(\"violin-boxplot.png\",\n       width = 10,\n       height = 8,\n       units = \"cm\")\n```\n:::\n\n\n## Saving your Figures 2\n\nYou can also assign the plot to an object in your environment (just like we did with the tibbles previously) and then tell `ggsave()` which object to save. This is a bit safer.\n\nRun the code for the violin-boxplot again and save the plot in an object called `viobox`. You'd then have to explicitly tell `ggsave()` to save the object `viobox`:\n\n\n::: {.cell output-location='column-fragment'}\n\n```{.r .cell-code  code-line-numbers=\"1,20\"}\nviobox <- summarydata %>%\n  ggplot(aes(x = income,\n             y = ahiTotal,\n             fill = income)) +\n  geom_violin(trim = FALSE, \n              show.legend = FALSE, \n              alpha = .4) +\n  geom_boxplot(width = .2, \n               show.legend = FALSE, \n               alpha = .7)+\n  scale_x_discrete(name = \"Income\",\n                   labels = c(\"Below Average\", \n                              \"Average\", \n                              \"Above Average\")) +\n  scale_y_continuous(name = \"Authentic Happiness Inventory Score\")+\n  theme_minimal() +\n  scale_fill_viridis_d()\n\n\nggsave(\"violin-boxplot-stored.png\", plot = viobox)\n```\n:::\n\n\n::: notes\nDo not add `ggsave()` to the plot with a `+`. Instead run it on a separate line!\n\nIf plot is assigned to object, it won't be displayed unless you type `viobox` in the console!\n:::\n\n## Thanks!\n\nCheck out [Chapter 13 of QuantFun](https://psyteachr.github.io/quant-fun-v2/visualisation.html) for further exercises and tips for data visualization!\n\nAlso keep in mind: Coding is a lot of googling things!\n\nYou can also check out the [R Graph Gallery](https://r-graph-gallery.com/) for code for different types of plots.\n\n. . .\n\n**Learning objectives**\n\n-   Know how to transform (pivot) and join data\n\n-   Understand the basics of a ggplot (layers etc.)\n\n-   Be able to make your first own plots, such as bar charts, violin + boxplots, scatterplots\n\n-   Know what a grouped plot and a facetted plot is\n\n. . .\n\n**Next:**\n\n-   ? (More data wrangling? Data viz?)\n-   Should we make a plot with real data from one of you?\n-   When? 19th -\\> defense, 26th -\\> easter break... Wednesday, 20th?\n\n**General Question:**\n\n-   Online?\n\n-   Is this \\~every other week fine?\n",
    "supporting": [
      "W3b_DataVizR_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-after-body": [
        "\r\n<script>\r\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\r\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\r\n  // slide changes (different for each slide format).\r\n  (function () {\r\n    // dispatch for htmlwidgets\r\n    function fireSlideEnter() {\r\n      const event = window.document.createEvent(\"Event\");\r\n      event.initEvent(\"slideenter\", true, true);\r\n      window.document.dispatchEvent(event);\r\n    }\r\n\r\n    function fireSlideChanged(previousSlide, currentSlide) {\r\n      fireSlideEnter();\r\n\r\n      // dispatch for shiny\r\n      if (window.jQuery) {\r\n        if (previousSlide) {\r\n          window.jQuery(previousSlide).trigger(\"hidden\");\r\n        }\r\n        if (currentSlide) {\r\n          window.jQuery(currentSlide).trigger(\"shown\");\r\n        }\r\n      }\r\n    }\r\n\r\n    // hookup for slidy\r\n    if (window.w3c_slidy) {\r\n      window.w3c_slidy.add_observer(function (slide_num) {\r\n        // slide_num starts at position 1\r\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\r\n      });\r\n    }\r\n\r\n  })();\r\n</script>\r\n\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}