<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Dr.&nbsp;Lea Hildebrandt">
<meta name="dcterms.date" content="2024-01-23">
<meta name="description" content="Getting the raw data in a useful format">

<title>R Club Würzburg - Data Wrangling</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
<link rel="stylesheet" href="../include/webex.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">R Club Würzburg</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../slides.html" rel="" target="">
 <span class="menu-text">Slides</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../about.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#data-wrangling" id="toc-data-wrangling" class="nav-link active" data-scroll-target="#data-wrangling">Data Wrangling?</a></li>
  <li><a href="#accessing-variablescolumns" id="toc-accessing-variablescolumns" class="nav-link" data-scroll-target="#accessing-variablescolumns">Accessing Variables/Columns</a></li>
  <li><a href="#tidyverse" id="toc-tidyverse" class="nav-link" data-scroll-target="#tidyverse">Tidyverse</a></li>
  <li><a href="#tidyverse-2" id="toc-tidyverse-2" class="nav-link" data-scroll-target="#tidyverse-2">Tidyverse 2</a></li>
  <li><a href="#activity-1-babynames" id="toc-activity-1-babynames" class="nav-link" data-scroll-target="#activity-1-babynames">Activity 1: Babynames</a></li>
  <li><a href="#activity-2-look-at-the-data" id="toc-activity-2-look-at-the-data" class="nav-link" data-scroll-target="#activity-2-look-at-the-data">Activity 2: Look at the Data</a></li>
  <li><a href="#activity-3-your-first-plot" id="toc-activity-3-your-first-plot" class="nav-link" data-scroll-target="#activity-3-your-first-plot">Activity 3: Your First Plot</a></li>
  <li><a href="#wrangling-babynames" id="toc-wrangling-babynames" class="nav-link" data-scroll-target="#wrangling-babynames">Wrangling Babynames</a>
  <ul class="collapse">
  <li><a href="#activity-4-selecting-variables-of-interest" id="toc-activity-4-selecting-variables-of-interest" class="nav-link" data-scroll-target="#activity-4-selecting-variables-of-interest">Activity 4: Selecting Variables of Interest</a></li>
  <li><a href="#activity-5-arranging-data" id="toc-activity-5-arranging-data" class="nav-link" data-scroll-target="#activity-5-arranging-data">Activity 5: Arranging Data</a></li>
  <li><a href="#activity-6-filter-observations" id="toc-activity-6-filter-observations" class="nav-link" data-scroll-target="#activity-6-filter-observations">Activity 6: Filter Observations</a></li>
  <li><a href="#detour-boolean-expressions" id="toc-detour-boolean-expressions" class="nav-link" data-scroll-target="#detour-boolean-expressions">Detour: Boolean Expressions</a></li>
  <li><a href="#activity-6b-filter-some-more" id="toc-activity-6b-filter-some-more" class="nav-link" data-scroll-target="#activity-6b-filter-some-more">Activity 6b: Filter some more</a></li>
  <li><a href="#activity-7-create-new-variables" id="toc-activity-7-create-new-variables" class="nav-link" data-scroll-target="#activity-7-create-new-variables">Activity 7: Create New Variables</a></li>
  <li><a href="#activity-8-summarizing" id="toc-activity-8-summarizing" class="nav-link" data-scroll-target="#activity-8-summarizing">Activity 8: Summarizing</a></li>
  <li><a href="#activity-8-grouping-and-summarizing" id="toc-activity-8-grouping-and-summarizing" class="nav-link" data-scroll-target="#activity-8-grouping-and-summarizing">Activity 8: Grouping and Summarizing</a></li>
  <li><a href="#activity-8b-grouping-and-summarizing-2" id="toc-activity-8b-grouping-and-summarizing-2" class="nav-link" data-scroll-target="#activity-8b-grouping-and-summarizing-2">Activity 8b: Grouping and Summarizing 2</a></li>
  <li><a href="#pipes" id="toc-pipes" class="nav-link" data-scroll-target="#pipes">Pipes</a></li>
  <li><a href="#counting-data" id="toc-counting-data" class="nav-link" data-scroll-target="#counting-data">Counting Data</a></li>
  <li><a href="#ungrouping" id="toc-ungrouping" class="nav-link" data-scroll-target="#ungrouping">Ungrouping</a></li>
  </ul></li>
  <li><a href="#data-wrangling-3" id="toc-data-wrangling-3" class="nav-link" data-scroll-target="#data-wrangling-3">Data Wrangling 3</a>
  <ul class="collapse">
  <li><a href="#tidy-data" id="toc-tidy-data" class="nav-link" data-scroll-target="#tidy-data">Tidy Data</a></li>
  <li><a href="#tidy-data-2" id="toc-tidy-data-2" class="nav-link" data-scroll-target="#tidy-data-2">Tidy Data 2</a></li>
  <li><a href="#analyzing-the-autism-spectrum-quotient" id="toc-analyzing-the-autism-spectrum-quotient" class="nav-link" data-scroll-target="#analyzing-the-autism-spectrum-quotient">Analyzing the Autism Spectrum Quotient</a></li>
  <li><a href="#set-up" id="toc-set-up" class="nav-link" data-scroll-target="#set-up">Set Up</a></li>
  <li><a href="#load-the-data" id="toc-load-the-data" class="nav-link" data-scroll-target="#load-the-data">Load the Data</a></li>
  <li><a href="#look-at-the-data" id="toc-look-at-the-data" class="nav-link" data-scroll-target="#look-at-the-data">Look at the Data</a></li>
  <li><a href="#reformatting-the-data" id="toc-reformatting-the-data" class="nav-link" data-scroll-target="#reformatting-the-data">Reformatting the Data</a></li>
  <li><a href="#joining-the-data" id="toc-joining-the-data" class="nav-link" data-scroll-target="#joining-the-data">Joining the Data</a></li>
  <li><a href="#combining-more-data" id="toc-combining-more-data" class="nav-link" data-scroll-target="#combining-more-data">Combining more Data</a></li>
  <li><a href="#calculate-the-questionnaire-scores" id="toc-calculate-the-questionnaire-scores" class="nav-link" data-scroll-target="#calculate-the-questionnaire-scores">Calculate the Questionnaire Scores</a></li>
  <li><a href="#pipe-it-all-together" id="toc-pipe-it-all-together" class="nav-link" data-scroll-target="#pipe-it-all-together">Pipe it all together!</a></li>
  </ul></li>
  <li><a href="#data-wrangling-2" id="toc-data-wrangling-2" class="nav-link" data-scroll-target="#data-wrangling-2">Data Wrangling 2</a>
  <ul class="collapse">
  <li><a href="#learning-to-wrangle" id="toc-learning-to-wrangle" class="nav-link" data-scroll-target="#learning-to-wrangle">Learning to Wrangle</a></li>
  <li><a href="#solutions" id="toc-solutions" class="nav-link" data-scroll-target="#solutions">Solutions</a></li>
  <li><a href="#solutions-1" id="toc-solutions-1" class="nav-link" data-scroll-target="#solutions-1">Solutions</a></li>
  <li><a href="#thanks" id="toc-thanks" class="nav-link" data-scroll-target="#thanks">Thanks!</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/Hillea/rclubwue/edit/main/Slides/W2b_DataWranglingR.qmd" class="toc-action">Edit this page</a></p><p><a href="https://github.com/Hillea/rclubwue/issues/new" class="toc-action">Report an issue</a></p></div></div><div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="W2b_DataWranglingR.html"><i class="bi bi-file-slides"></i>RevealJS</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Data Wrangling</h1>
<p class="subtitle lead"></p><p>R Coding Club<br>
RTG 2660</p><p></p>
</div>

<div>
  <div class="description">
    Getting the raw data in a useful format
  </div>
</div>


<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Dr.&nbsp;Lea Hildebrandt </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">January 23, 2024</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="data-wrangling" class="level2">
<h2 class="anchored" data-anchor-id="data-wrangling">Data Wrangling?</h2>
<div class="cell">
<style type="text/css">
code.sourceCode {
  font-size: 1.4em;
}

div.cell-output-stdout {
  font-size: 1.4em;
}
</style>
</div>
<p>“Preparation” of the data for analysis: cleaning up variables (outliers, erroneous values, recoding…), changing the structure/format of data frames, merging data sets, calculating new variables, reducing/summarizing variables…</p>
<p>. . .</p>
<p>You will spend a lot more time wrangling the data than analyzing it!</p>
<p>. . .</p>
<p>You could do this manually (e.g.&nbsp;in Excel), but this is tedious, error prone &amp; not reproducible! (+ Datasets can be huge!)</p>
<p>. . .</p>
<p>Fortunately, it is easy to do in R</p>
</section>
<section id="accessing-variablescolumns" class="level2">
<h2 class="anchored" data-anchor-id="accessing-variablescolumns">Accessing Variables/Columns</h2>
<p>When wrangling your data in R, you often want to access/use different columns, e.g.&nbsp;to calculate new ones. There are a number of ways you can do that:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create a small data set for this example:</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>testdata <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">a =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>),  <span class="co"># the c() is important!</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">b =</span> <span class="fu">c</span>(<span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>),</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">c =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>))</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="do">## access column a only:</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Option 1:</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>testdata<span class="sc">$</span>a</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1 2 3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Option 2:</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>testdata[<span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>,<span class="st">"a"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2 3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>testdata[, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]  <span class="co"># index the first column (better practice to use the name!)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  a b
1 1 a
2 2 b
3 3 c</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># this way, you could also access rows:</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co"># testdata[1:2, ]  # [rows, columns] --&gt; you can leave it empty if you want all</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 1:10 would mean 1 to and incl 10!</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Option 3 (select is a tidyverse function)</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(testdata, a)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  a
1 1
2 2
3 3</code></pre>
</div>
</div>
<div class="notes">
<p>data.frame() = function to create a data.frame, which is what holds a data set! (tibbles..)</p>
<p>c() = function to make a vector. A vector is just like one single column of a data frame: It can hold several values, but all of the same type.</p>
<p>subsetting: rows, columns –&gt; leave empty!<br>
Select range!<br>
Use either name or index of column!</p>
<p>select –&gt; tidyverse</p>
</div>
</section>
<section id="tidyverse" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="tidyverse">Tidyverse</h2>
<p>You can do all data wrangling in Base R, i.e.&nbsp;without loading any packages. However, there’s a neat collection of packages called <strong>tidyverse</strong>, which makes data wrangling even easier!</p>
<p>. . .</p>
<p>Base R:</p>
<p><code>output_data1 &lt;- function1(data)</code></p>
<p><code>output_data2 &lt;- function2(output_data1)</code></p>
<p><code>output_data3 &lt;- function3(output_data2)</code></p>
<p>. . .</p>
<p>Or:</p>
<p><code>output_data &lt;- function3(function2(function1(data)))</code></p>
<p>. . .</p>
<p>Tidyverse:</p>
<p><code>output_data &lt;- data %&gt;% function1() %&gt;% function2(.) %&gt;% function3()</code></p>

<div class="no-row-height column-margin column-container"><div class="">
<p><code>%&gt;%</code> is called the <em>pipe</em>. It takes the output of whatever happens to its left and “hands it over” to the right. There’s also a new base-R-pipe: <code>|&gt;</code>. It is very similar, but sometimes the functionality differs.</p>
</div></div><div class="notes">
<p>Be aware, though, that coding in the tidyverse style is very different than in Base R!</p>
<p>Base R is more similar to “traditional” programming and other programming languages.<br>
For example, you could wrap functions, which would then be carried out from the most nested to the outer function:<br>
<code>output_data &lt;- function3(function2(function1(data)))</code></p>
<p><code>function1()</code> will be carried out first, followed by <code>function2()</code>, then <code>function3()</code> .</p>
<p>. . .</p>
<p>In the tidyverse, the same would look like this:</p>
<p><code>output_data &lt;- data %&gt;% function1() %&gt;% function2() %&gt;% function(3)</code></p>
<p><code>%&gt;%</code> is called “the pipe” and will “hand over” whatever has been done to the next part. In this example, the <code>data</code> is handed over to <code>function1()</code>, which is then carried out, the result of which is handed over to <code>function2()</code> etc.</p>
<p>Tidyverse style programming is thus a bit easier to read!</p>
<p>There’s also the new pipe Base R |&gt;, which is similar to %&gt;%.</p>
</div>
</section>
<section id="tidyverse-2" class="level2">
<h2 class="anchored" data-anchor-id="tidyverse-2">Tidyverse 2</h2>
<p><code>library(tidyverse)</code> will load a number of packages, such as <em>dplyr</em>, <em>ggplot2</em>, <em>readr</em>, <em>forcats</em>, <em>tibble</em> etc., which are all usefuls for data wrangling.</p>
<p>We will work mainly with functions from the <em>dplyr</em> package, but also use <em>readr</em> to read in data. We will also use <em>ggplot2</em> to visualize data.</p>
<p>The most important dplyr functions for data wrangling are:</p>
<table class="table">
<colgroup>
<col style="width: 18%">
<col style="width: 81%">
</colgroup>
<thead>
<tr class="header">
<th>Function</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>select()</td>
<td>Include or exclude certain columns (variables)</td>
</tr>
<tr class="even">
<td>filter()</td>
<td>Include or exclude certain rows (observations)</td>
</tr>
<tr class="odd">
<td>mutate()</td>
<td>Create new columns (variables)</td>
</tr>
<tr class="even">
<td>summarize()</td>
<td>Create new columns that aggregate data/create summary variables for groups of observations (data frame will become smaller)</td>
</tr>
<tr class="odd">
<td>group_by()</td>
<td>Organize the rows (observations) into groups</td>
</tr>
<tr class="even">
<td>arrange()</td>
<td>Change the order of rows (observations)</td>
</tr>
</tbody>
</table>
<div class="notes">
<p>function names very self-explanatory!</p>
</div>
</section>
<section id="activity-1-babynames" class="level2">
<h2 class="anchored" data-anchor-id="activity-1-babynames">Activity 1: Babynames</h2>
<ol type="1">
<li><p>Open RStudio and set the working directory, ensure the environment is clean.</p></li>
<li><p>Open a new RMarkdown document and save it, e.g.&nbsp;as “DataWrangling1.Rmd”.</p></li>
<li><p>Install the packages “tidyverse” and “babynames”.</p></li>
<li><p>Delete the default text in the Rmd file, insert a new code chunk and insert code that loads the packages babynames and tidyverse.</p></li>
</ol>
<p>. . .</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("tidyverse")</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("babynames")</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(babynames)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="notes">
<p>load tidyverse last, otherwise functions with same name will be masked from package that is loaded first. Since we often need tidyverse functions, it’s safest to load it last!</p>
</div>
</section>
<section id="activity-2-look-at-the-data" class="level2">
<h2 class="anchored" data-anchor-id="activity-2-look-at-the-data">Activity 2: Look at the Data</h2>
<div class="incremental">
<ol class="incremental" type="1">
<li><p>Type the word <code>babynames</code> into your console pane and press enter. What kind of information do you get?</p>
<ul class="incremental">
<li><p>“A tibble: 1,924,665 x 5”</p>
<ul class="incremental">
<li><p>tibble is a format for the data frame</p></li>
<li><p>~1.9 million rows/observations</p></li>
<li><p>5 columns/variables</p></li>
</ul></li>
</ul></li>
<li><p>What kind of columns/variables do we have?</p>
<ul class="incremental">
<li><p>dbl = double/numeric (can take decimals)</p></li>
<li><p>chr = character/string (letters or words)</p></li>
<li><p>int = integer (cannot take decimales)</p></li>
<li><p>(there are also factors = nominal categories (can be words or numbers))</p></li>
</ul></li>
</ol>
</div>
<div class="notes">
<p>ask first for 1 and 2</p>
</div>
</section>
<section id="activity-3-your-first-plot" class="level2">
<h2 class="anchored" data-anchor-id="activity-3-your-first-plot">Activity 3: Your First Plot</h2>
<ol type="1">
<li>In a new code chunk, insert and run the following code:</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> babynames <span class="sc">%&gt;%</span> </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Emily"</span>,</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"Kathleen"</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"Alexandra"</span>,</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"Beverly"</span>), sex<span class="sc">==</span><span class="st">"F"</span>)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> dat,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> year,</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> prop, </span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>           <span class="at">colour =</span> name))<span class="sc">+</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="W2b_DataWranglingR_files/figure-revealjs/unnamed-chunk-5-1.png" class="img-fluid" width="960"></p>
</div>
</div>
<p>We first filter four names, assign this new data to <code>dat</code>, and make a linechart using <code>ggplot()</code>!</p>
<p>. . .</p>
<ol start="2" type="1">
<li>Change the code to male names (that are hopefully present in the dataset) and change <code>sex=="F"</code> to <code>sex=="M"</code>.</li>
</ol>
</section>
<section id="wrangling-babynames" class="level1">
<h1>Wrangling Babynames</h1>
<section id="activity-4-selecting-variables-of-interest" class="level2">
<h2 class="anchored" data-anchor-id="activity-4-selecting-variables-of-interest">Activity 4: Selecting Variables of Interest</h2>
<ol type="1">
<li>In a new code chunk, use <code>select()</code> to select only the columns <code>year</code>, <code>sex</code>, <code>name</code>, and <code>prop</code> and store it as a new tibble called <code>babynames_reduced</code>. Remember that you can run <code>?select</code> in the console if you need help, e.g.&nbsp;regarding the input/arguments to the function.</li>
</ol>
<p>. . .</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>babynames_reduced <span class="ot">&lt;-</span> <span class="fu">select</span>(<span class="at">.data =</span> babynames, year, sex, name, prop)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co"># or alternatively:</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>babynames_reduced <span class="ot">&lt;-</span> babynames <span class="sc">%&gt;%</span> </span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(year, sex, name, prop)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="co"># or alternatively:</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>babynames_reduced <span class="ot">&lt;-</span> babynames <span class="sc">%&gt;%</span> </span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>n) <span class="co"># remove using -</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="activity-5-arranging-data" class="level2">
<h2 class="anchored" data-anchor-id="activity-5-arranging-data">Activity 5: Arranging Data</h2>
<p>Change the order of the data (oberservations/rows)!</p>
<div class="incremental">
<ol class="incremental" type="1">
<li>Using <code>arrange()</code>, try sorting the data according to the <code>names</code> column.
<ol class="incremental" type="1">
<li>What happens?</li>
</ol></li>
<li>How can you sort a column in a descending fashion? Check out the help file (<code>?arrange</code>).</li>
</ol>
</div>
<p>. . .</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>sort_asc <span class="ot">&lt;-</span> <span class="fu">arrange</span>(<span class="at">.data =</span> babynames,</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>                    name)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>sort_desc <span class="ot">&lt;-</span> <span class="fu">arrange</span>(babynames, </span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">desc</span>(year)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="notes">
<p>remember to save data in new tibble/data frame!</p>
</div>
</section>
<section id="activity-6-filter-observations" class="level2">
<h2 class="anchored" data-anchor-id="activity-6-filter-observations">Activity 6: Filter Observations</h2>
<p>We have already used <code>select()</code> to keep only certain variables, but often we also want to keep only certain observations, e.g.&nbsp;babies born after 1999 (or reaction times that are realistic, not too fast and not too slow, or certain conditions).</p>
<p>We use the function <code>filter()</code> for this.</p>
<p>. . .</p>
<p>Look at the following code and think about what it might do.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>filt1 <span class="ot">&lt;-</span> <span class="fu">filter</span>(<span class="at">.data =</span> babynames,</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>                year <span class="sc">&gt;</span> <span class="dv">2000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="detour-boolean-expressions" class="level2">
<h2 class="anchored" data-anchor-id="detour-boolean-expressions">Detour: Boolean Expressions</h2>
<p>The second argument, <code>year &gt; 2000</code>, is a Boolean or logical expression, which means that it results in a value of either TRUE or FALSE. <code>filter()</code> runs this expression and then removes all values/rows that contain FALSE.</p>
<p>There are also other Boolean expressions:</p>
<table class="table">
<caption>Boolean expressions</caption>
<colgroup>
<col style="width: 22%">
<col style="width: 26%">
<col style="width: 51%">
</colgroup>
<thead>
<tr class="header">
<th>Operator</th>
<th>Name</th>
<th>is TRUE if and only if</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>A &lt; B</td>
<td>less than</td>
<td>A is less than B</td>
</tr>
<tr class="even">
<td>A &lt;= B</td>
<td>less than or equal</td>
<td>A is less than or equal to B</td>
</tr>
<tr class="odd">
<td>A &gt; B</td>
<td>greater than</td>
<td>A is greater than B</td>
</tr>
<tr class="even">
<td>A &gt;= B</td>
<td>greater than or equal</td>
<td>A is greater than or equal to B</td>
</tr>
<tr class="odd">
<td>A == B</td>
<td>equivalence</td>
<td>A exactly equals B</td>
</tr>
<tr class="even">
<td>A != B</td>
<td>not equal</td>
<td>A does not exactly equal B</td>
</tr>
<tr class="odd">
<td>A %in% B</td>
<td>in</td>
<td>A is an element of <u>vector</u> B</td>
</tr>
</tbody>
</table>
</section>
<section id="activity-6b-filter-some-more" class="level2">
<h2 class="anchored" data-anchor-id="activity-6b-filter-some-more">Activity 6b: Filter some more</h2>
<div class="incremental">
<ol class="incremental" type="1">
<li>Keep only those observations with the name “Mary”.</li>
<li>Discard all “Mary”’s and keep only observations from year &gt; 2000.</li>
<li>Keep only those with names of former Queens (Mary, Elizabeth, Victoria).</li>
<li>Discard the ones with the Queen names!</li>
</ol>
</div>
<p>. . .</p>
<p>First task:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>marys <span class="ot">&lt;-</span> <span class="fu">filter</span>(babynames, name <span class="sc">==</span> <span class="st">"Mary"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>. . .</p>
<p>The second task might be difficult because you have two expressions, <code>name != "Mary"</code> and <code>year &gt; 2000</code>. You can simply add several expressions separated by comma’s in filter:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>no_marys_young <span class="ot">&lt;-</span> <span class="fu">filter</span>(babynames, name <span class="sc">!=</span> <span class="st">"Mary"</span>, year <span class="sc">&gt;</span> <span class="dv">2000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>. . .</p>
<p>Third task:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>queens <span class="ot">&lt;-</span> <span class="fu">filter</span>(babynames, name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Mary"</span>, <span class="st">"Elizabeth"</span>, <span class="st">"Victoria"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>. . .</p>
<p>The fourth task is a bit tricky! You could use three filters in a row with <code>name!="Mary"</code> (or “Elizabeth” or “Victoria”). Or you could use %in%, but then you can’t use the <code>!</code> in front of the <code>%in%</code>. An alternative to negate the whole expression with <code>!</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>no_queens <span class="ot">&lt;-</span> <span class="fu">filter</span>(babynames, </span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>                    <span class="sc">!</span>(name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Mary"</span>,</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">"Elizabeth"</span>,</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">"Victoria"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="activity-7-create-new-variables" class="level2">
<h2 class="anchored" data-anchor-id="activity-7-create-new-variables">Activity 7: Create New Variables</h2>
<p>If we want to create variables that do not exist yet (i.e.&nbsp;by calculating values, combining other variables etc.), we can use <code>mutate()</code>!</p>
<ol type="1">
<li>Add a variable called “country” that contains the value “USA” for all observations</li>
</ol>
<p>. . .</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>baby_where <span class="ot">&lt;-</span> <span class="fu">mutate</span>(<span class="at">.data =</span> babynames,</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">country =</span> <span class="st">"USA"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>. . .</p>
<p>But mutate is much more powerful and can create variables that differ per observation, depending on other values in the tibble/data frame:</p>
<ol start="2" type="1">
<li>Create a variable that denotes the decade a baby was born:</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>baby_decades <span class="ot">&lt;-</span> <span class="fu">mutate</span>(<span class="at">.data =</span> babynames,</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">decade =</span> <span class="fu">floor</span>(year<span class="sc">/</span><span class="dv">10</span>) <span class="sc">*</span><span class="dv">10</span>)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(baby_decades)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 6
   year sex   name          n   prop decade
  &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;     &lt;int&gt;  &lt;dbl&gt;  &lt;dbl&gt;
1  1880 F     Mary       7065 0.0724   1880
2  1880 F     Anna       2604 0.0267   1880
3  1880 F     Emma       2003 0.0205   1880
4  1880 F     Elizabeth  1939 0.0199   1880
5  1880 F     Minnie     1746 0.0179   1880
6  1880 F     Margaret   1578 0.0162   1880</code></pre>
</div>
</div>
<p>What happens here?</p>
</section>
<section id="activity-8-summarizing" class="level2">
<h2 class="anchored" data-anchor-id="activity-8-summarizing">Activity 8: Summarizing</h2>
<p>The goal of data wrangling is often to summarize (or aggregate) the data, e.g.&nbsp;to have an average value per condition. Sometimes you’d also want to calculate descriptive statistics to report.</p>
<p>. . .</p>
<p>You can do so using the function <code>summarise()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># run the filter function just like above again:</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> babynames <span class="sc">%&gt;%</span> </span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Emily"</span>,</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"Kathleen"</span>,</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"Alexandra"</span>,</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"Beverly"</span>), sex <span class="sc">==</span> <span class="st">"F"</span>)</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="co"># summarize the data, calculating the number of oberservations:</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>dat_sum <span class="ot">&lt;-</span> <span class="fu">summarise</span>(<span class="at">.data =</span> dat,</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>                     <span class="at">total =</span> <span class="fu">sum</span>(n))</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>dat_sum</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
    total
    &lt;int&gt;
1 2161374</code></pre>
</div>
</div>
<p>As you can see, a new variable named total is created, which contains the total number of observations. There’s also just one row in the data frame, because summarise() reduces the data frame (to only include the necessary information)!</p>
</section>
<section id="activity-8-grouping-and-summarizing" class="level2">
<h2 class="anchored" data-anchor-id="activity-8-grouping-and-summarizing">Activity 8: Grouping and Summarizing</h2>
<p>Often, we want to summarize data for specific subgroups, e.g.&nbsp;conditions. For this aim, we use <code>summarise()</code> together with <code>group_by()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>group_dat <span class="ot">&lt;-</span> <span class="fu">group_by</span>(<span class="at">.data =</span> dat,</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>                      name) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>group_dat</code> now doesn’t look much different than <code>dat</code>, but the grouping - based on the names, so each name is now a category - is saved in the data frame! (Type <code>group_dat</code> in the console and you will see #Groups: name[4])</p>
<p>If you now run the summarize() code from before (but with <code>group_dat</code> as input), you will not get the total number of observations, but the observations per name!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>group_sum <span class="ot">&lt;-</span> <span class="fu">summarise</span>(<span class="at">.data =</span> group_dat, </span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">total =</span> <span class="fu">sum</span>(n)) </span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>group_sum</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 2
  name       total
  &lt;chr&gt;      &lt;int&gt;
1 Alexandra 231364
2 Beverly   376914
3 Emily     841491
4 Kathleen  711605</code></pre>
</div>
</div>
</section>
<section id="activity-8b-grouping-and-summarizing-2" class="level2">
<h2 class="anchored" data-anchor-id="activity-8b-grouping-and-summarizing-2">Activity 8b: Grouping and Summarizing 2</h2>
<p>You can group by several columns (think of crosstables) and add several columns at once to the data (e.g.&nbsp;doing different calculations - same for <code>mutate()</code>!)</p>
<ol type="1">
<li>Use the <code>baby_decades</code> data frame and <code>group_by()</code> sex &amp; decade. Save the output to a new data frame/tibble</li>
<li>Use that tibble to calculate the mean and median number of observations.</li>
</ol>
<p>. . .</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>group_decades <span class="ot">&lt;-</span> <span class="fu">group_by</span>(baby_decades, </span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>                          sex, </span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>                          decade)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>sum_decades <span class="ot">&lt;-</span> <span class="fu">summarise</span>(group_decades,</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>                         <span class="at">mean_year =</span> <span class="fu">mean</span>(n),</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>                         <span class="at">median_year =</span> <span class="fu">median</span>(n))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="pipes" class="level2">
<h2 class="anchored" data-anchor-id="pipes">Pipes</h2>
<p>Remember the pipe <code>%&gt;%</code>? So far we have always saved intermediate steps in tibbles and used those as input for the next function. With the pipe, we can chain several functions and save relevant results only, no need for crowding the Environment with intermediate tibbles!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>pipe_summary <span class="ot">&lt;-</span> babynames <span class="sc">%&gt;%</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">decade =</span> <span class="fu">floor</span>(year<span class="sc">/</span><span class="dv">10</span>) <span class="sc">*</span><span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Emily"</span>,</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"Kathleen"</span>,</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"Alexandra"</span>,</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"Beverly"</span>), sex<span class="sc">==</span><span class="st">"F"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(name, </span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>           decade) <span class="sc">%&gt;%</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_decade =</span> <span class="fu">mean</span>(n))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="counting-data" class="level2">
<h2 class="anchored" data-anchor-id="counting-data">Counting Data</h2>
<p>There are several ways to get the number of observations per group. In the tidyverse style, one is to use (<code>group_by()</code> +) <code>summarise()</code> with the function <code>n()</code>. The other, a shortcut, is to use <code>count()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>babynames <span class="sc">%&gt;%</span> </span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">filter</span>(name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Emily"</span>,</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"Kathleen"</span>,</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"Alexandra"</span>,</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"Beverly"</span>), sex<span class="sc">==</span><span class="st">"F"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(name) <span class="sc">%&gt;%</span> </span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 2
  name          n
  &lt;chr&gt;     &lt;int&gt;
1 Alexandra   117
2 Beverly     122
3 Emily       138
4 Kathleen    138</code></pre>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>babynames <span class="sc">%&gt;%</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Emily"</span>,</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"Kathleen"</span>,</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"Alexandra"</span>,</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"Beverly"</span>), sex<span class="sc">==</span><span class="st">"F"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(name)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 2
  name          n
  &lt;chr&gt;     &lt;int&gt;
1 Alexandra   117
2 Beverly     122
3 Emily       138
4 Kathleen    138</code></pre>
</div>
</div>
</section>
<section id="ungrouping" class="level2">
<h2 class="anchored" data-anchor-id="ungrouping">Ungrouping</h2>
<p>Remember that the grouping done with <code>group_by()</code> is saved with the data frame (even though it might not immediately be obvious).</p>
<p>It is good practice to always <code>ungroup()</code> your data once you finished the operations you needed the grouping for!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1"></a>babynames <span class="sc">%&gt;%</span> </span>
<span id="cb32-2"><a href="#cb32-2"></a>   <span class="fu">filter</span>(name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Emily"</span>,</span>
<span id="cb32-3"><a href="#cb32-3"></a>                     <span class="st">"Kathleen"</span>,</span>
<span id="cb32-4"><a href="#cb32-4"></a>                     <span class="st">"Alexandra"</span>,</span>
<span id="cb32-5"><a href="#cb32-5"></a>                     <span class="st">"Beverly"</span>), sex<span class="sc">==</span><span class="st">"F"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb32-6"><a href="#cb32-6"></a>  <span class="fu">group_by</span>(name) <span class="sc">%&gt;%</span> </span>
<span id="cb32-7"><a href="#cb32-7"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb32-8"><a href="#cb32-8"></a>  <span class="fu">ungroup</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 2
  name          n
  &lt;chr&gt;     &lt;int&gt;
1 Alexandra   117
2 Beverly     122
3 Emily       138
4 Kathleen    138</code></pre>
</div>
</div>
</section>
</section>
<section id="data-wrangling-3" class="level1">
<h1>Data Wrangling 3</h1>
<div class="notes">
<p>Data Wrangling 2? More exercises! Homework! :)</p>
</div>
<section id="tidy-data" class="level2">
<h2 class="anchored" data-anchor-id="tidy-data">Tidy Data</h2>
<p>Tidy data: Data that is easily processed by tidyverse functions (and often the required format for statistical analyses and data visualizations).</p>
<p>Three principles:</p>
<ul>
<li><p>Each variable has its own column.</p></li>
<li><p>Each observation has its own row.</p></li>
<li><p>Each value has its own cell.</p></li>
</ul>
<p>. . .</p>
<p>Wide vs.&nbsp;long format data?</p>
<ul>
<li><p>Wide format: Each participant/animal… has one row, observations per participant are in columns.</p></li>
<li><p>Long format: Each observation = own row. (Likely several rows per participant: Trials etc.)</p></li>
</ul>
<div class="columns">
<div class="column">
<table class="table">
<thead>
<tr class="header">
<th>ID</th>
<th>Time_1</th>
<th>Time_2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>a1</td>
<td>230</td>
<td>310</td>
</tr>
<tr class="even">
<td>a2</td>
<td>195</td>
<td>220</td>
</tr>
<tr class="odd">
<td>a3</td>
<td>245</td>
<td>290</td>
</tr>
</tbody>
</table>
</div><div class="column">
<table class="table">
<thead>
<tr class="header">
<th>ID</th>
<th>Time</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>a1</td>
<td>1</td>
<td>230</td>
</tr>
<tr class="even">
<td>a1</td>
<td>2</td>
<td>310</td>
</tr>
<tr class="odd">
<td>a2</td>
<td>1</td>
<td>195</td>
</tr>
<tr class="even">
<td>a3</td>
<td>2</td>
<td>220</td>
</tr>
<tr class="odd">
<td>a3</td>
<td>1</td>
<td>245</td>
</tr>
<tr class="even">
<td>a3</td>
<td>2</td>
<td>290</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="notes">
<p>Data often does not come in this format but is rather messy! That’s why we wrangle.</p>
<p>Tidy data is in between wide and long (you can always go longer! :D)</p>
</div>
</section>
<section id="tidy-data-2" class="level2">
<h2 class="anchored" data-anchor-id="tidy-data-2">Tidy Data 2</h2>
<p>What do you think, which of the following data sets is tidy?</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
  country      year  cases population
  &lt;chr&gt;       &lt;dbl&gt;  &lt;dbl&gt;      &lt;dbl&gt;
1 Afghanistan  1999    745   19987071
2 Afghanistan  2000   2666   20595360
3 Brazil       1999  37737  172006362
4 Brazil       2000  80488  174504898
5 China        1999 212258 1272915272
6 China        2000 213766 1280428583</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 4
   country      year type            count
   &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt;           &lt;dbl&gt;
 1 Afghanistan  1999 cases             745
 2 Afghanistan  1999 population   19987071
 3 Afghanistan  2000 cases            2666
 4 Afghanistan  2000 population   20595360
 5 Brazil       1999 cases           37737
 6 Brazil       1999 population  172006362
 7 Brazil       2000 cases           80488
 8 Brazil       2000 population  174504898
 9 China        1999 cases          212258
10 China        1999 population 1272915272
11 China        2000 cases          213766
12 China        2000 population 1280428583</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 3
  country      year rate             
  &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt;            
1 Afghanistan  1999 745/19987071     
2 Afghanistan  2000 2666/20595360    
3 Brazil       1999 37737/172006362  
4 Brazil       2000 80488/174504898  
5 China        1999 212258/1272915272
6 China        2000 213766/1280428583</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 5
  country     `1999_cases` `2000_cases` `1999_population` `2000_population`
  &lt;chr&gt;              &lt;dbl&gt;        &lt;dbl&gt;             &lt;dbl&gt;             &lt;dbl&gt;
1 Afghanistan          745         2666          19987071          20595360
2 Brazil             37737        80488         172006362         174504898
3 China             212258       213766        1272915272        1280428583</code></pre>
</div>
</div>
<div class="notes">
<p>Table1 is tidy!</p>
</div>
</section>
<section id="analyzing-the-autism-spectrum-quotient" class="level2">
<h2 class="anchored" data-anchor-id="analyzing-the-autism-spectrum-quotient">Analyzing the Autism Spectrum Quotient</h2>
<p>For the following activities, we will need the following files:</p>
<ul>
<li><p><a href="https://psyteachr.github.io/quant-fun-v2/responses.csv">responses.csv</a> containing the AQ survey responses to each of the 10 questions for the 66 participants</p></li>
<li><p><a href="https://psyteachr.github.io/quant-fun-v2/qformats.csv">qformats.csv</a> containing information on how a question should be coded - i.e.&nbsp;forward or reverse coding</p></li>
<li><p><a href="https://psyteachr.github.io/quant-fun-v2/scoring.csv">scoring.csv</a> containing information on how many points a specific response should get; depending on whether it is forward or reverse coded</p></li>
<li><p><a href="https://psyteachr.github.io/quant-fun-v2/pinfo.csv">pinfo.csv</a> containing participant information such as <code>Age</code>, <code>Sex</code> and importantly <code>ID</code> number.</p></li>
</ul>
</section>
<section id="set-up" class="level2">
<h2 class="anchored" data-anchor-id="set-up">Set Up</h2>
<ol type="1">
<li><p>Clear your environment or restart the R session (Session -&gt; Restart R).</p></li>
<li><p>Start a new section (# Data Wrangling 3) in your Rmd document.</p></li>
<li><p>Make sure you have downloaded the data into your working directory (or set your working directory to the class folder with the data).</p></li>
</ol>
</section>
<section id="load-the-data" class="level2">
<h2 class="anchored" data-anchor-id="load-the-data">Load the Data</h2>
<p>Load the four .csv files into your environment, e.g.:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>responses <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"responses.csv"</span>) </span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>qformats <span class="ot">&lt;-</span>                 <span class="co"># load in question formats</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>scoring <span class="ot">&lt;-</span>                  <span class="co"># load in scoring info</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>pinfo <span class="ot">&lt;-</span>                    <span class="co"># load in participant information</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="look-at-the-data" class="level2">
<h2 class="anchored" data-anchor-id="look-at-the-data">Look at the Data</h2>
<p>Is the data (<code>responses</code>) in a tidy format?</p>
<p>. . .</p>
<p>Why is it not tidy?</p>
<div class="notes">
<p>wide format</p>
</div>
</section>
<section id="reformatting-the-data" class="level2">
<h2 class="anchored" data-anchor-id="reformatting-the-data">Reformatting the Data</h2>
<p>Let’s bring the wide data in a longer, tidy format!</p>
<p>. . .</p>
<p>There are several functions in R to reformat data, but the newest ones are <code>pivot_longer()</code> and <code>pivot_wider()</code>.</p>
<p>Run the code and see what changes:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>rlong <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(<span class="at">data =</span> responses,</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">cols =</span> Q1<span class="sc">:</span>Q10,</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">names_to =</span> <span class="st">"Question"</span>, </span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">values_to =</span> <span class="st">"Response"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>. . .</p>
<p>Describe what the function does, what does the input/the arguments mean?</p>
</section>
<section id="joining-the-data" class="level2">
<h2 class="anchored" data-anchor-id="joining-the-data">Joining the Data</h2>
<p>We now want to combine the different data sets: We want to have the information how the questionnaire has to be scored included with the items.</p>
<p>We can find the scoring information (i.e.&nbsp;how the questions are framed, positive or negative/whether they need to be reversed) in the <code>qformats</code> tibble. Furthermore, we can find how many points are given to each item/response in <code>scoring</code>.</p>
<p>We can use the function <code>inner_join()</code> to merge the tibbles.</p>
<p>. . .</p>
<p>Activity: Replace the <code>NULL</code> values in the below code with the necessary variable names to join <code>rlong</code> and <code>qformats</code> by <code>Question</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>rlong2 <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(<span class="at">x =</span> <span class="cn">NULL</span>, </span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y =</span> <span class="cn">NULL</span>, </span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">by =</span> <span class="st">"NULL"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>. . .</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>rlong2 <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(<span class="at">x =</span> rlong, </span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y =</span> qformats, </span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">by =</span> <span class="st">"Question"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="notes">
<p>Describe what happened?</p>
<p>what is forward and reverse scoring?</p>
</div>
</section>
<section id="combining-more-data" class="level2">
<h2 class="anchored" data-anchor-id="combining-more-data">Combining more Data</h2>
<p>You can only join two data frames/tibbles at once.<br>
Now add the scoring data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>rscores <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(rlong2, </span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>                      scoring, </span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">c</span>(<span class="st">"QFormat"</span>, <span class="st">"Response"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="calculate-the-questionnaire-scores" class="level2">
<h2 class="anchored" data-anchor-id="calculate-the-questionnaire-scores">Calculate the Questionnaire Scores</h2>
<p>How do we need to group and summarize the data to get a sum score per person? (Ignoring the reverse coding for now!) Add the correct column names instead of the <code>NULL</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>aq_scores <span class="ot">&lt;-</span> rscores <span class="sc">%&gt;%</span> </span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>             <span class="fu">group_by</span>(<span class="cn">NULL</span>) <span class="sc">%&gt;%</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>             <span class="fu">summarise</span>(<span class="at">AQ =</span> <span class="fu">sum</span>(<span class="cn">NULL</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>. . .</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>aq_scores <span class="ot">&lt;-</span> rscores <span class="sc">%&gt;%</span> </span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>             <span class="fu">group_by</span>(Id) <span class="sc">%&gt;%</span> <span class="co"># group by the ID number in column Id</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>             <span class="fu">summarise</span>(<span class="at">AQ =</span> <span class="fu">sum</span>(Score)) <span class="co"># sum column Score to obtain AQ scores.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="pipe-it-all-together" class="level2">
<h2 class="anchored" data-anchor-id="pipe-it-all-together">Pipe it all together!</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>aq_scores2 <span class="ot">&lt;-</span> responses <span class="sc">%&gt;%</span> </span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> Q1<span class="sc">:</span>Q10,</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"Question"</span>, </span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"Response"</span>) <span class="sc">%&gt;%</span>  </span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(qformats, <span class="st">"Question"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(scoring, <span class="fu">c</span>(<span class="st">"QFormat"</span>, <span class="st">"Response"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Id) <span class="sc">%&gt;%</span> </span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">AQ =</span> <span class="fu">sum</span>(Score)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="data-wrangling-2" class="level1">
<h1>Data Wrangling 2</h1>
<section id="learning-to-wrangle" class="level2">
<h2 class="anchored" data-anchor-id="learning-to-wrangle">Learning to Wrangle</h2>
<p>In small groups (or as <strong>homework</strong>), work in small groups on the assignments (Activity 1 - Activity 8) in this chapter: <a href="https://psyteachr.github.io/quant-fun-v2/data-wrangling-2.html" class="uri">https://psyteachr.github.io/quant-fun-v2/data-wrangling-2.html</a></p>
</section>
<section id="solutions" class="level2">
<h2 class="anchored" data-anchor-id="solutions">Solutions</h2>
<p>We’ll use data from a <a href="https://journals.sagepub.com/doi/full/10.1177/0956797617730892">paper</a> that investigates whether the ability to perform an action influences perception. In particular, the authors wondered whether participants who played Pong would perceive the ball to move faster when they have a small paddle.</p>
<div class="incremental">
<ol class="incremental" type="1">
<li><p>Download the data, set the working directory, clean your environment. Open a new R Markdown file and save it as “DataWrangling2.Rmd”. Delete the text in the document.</p></li>
<li><p>Add a new code chunk and read in the data.</p></li>
<li><p>Look at the data.</p></li>
</ol>
</div>
</section>
<section id="solutions-1" class="level2">
<h2 class="anchored" data-anchor-id="solutions-1">Solutions</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"tidyverse"</span>)</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>pong_data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"Data/PongBlueRedBack 1-16 Codebook.csv"</span>)</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(pong_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Participant     JudgedSpeed      PaddleLength   BallSpeed    TrialNumber    
 Min.   : 1.00   Min.   :0.0000   Min.   : 50   Min.   :2.0   Min.   :  1.00  
 1st Qu.: 4.75   1st Qu.:0.0000   1st Qu.: 50   1st Qu.:3.0   1st Qu.: 72.75  
 Median : 8.50   Median :1.0000   Median :150   Median :4.5   Median :144.50  
 Mean   : 8.50   Mean   :0.5471   Mean   :150   Mean   :4.5   Mean   :144.50  
 3rd Qu.:12.25   3rd Qu.:1.0000   3rd Qu.:250   3rd Qu.:6.0   3rd Qu.:216.25  
 Max.   :16.00   Max.   :1.0000   Max.   :250   Max.   :7.0   Max.   :288.00  
 BackgroundColor      HitOrMiss       BlockNumber   
 Length:4608        Min.   :0.0000   Min.   : 1.00  
 Class :character   1st Qu.:0.0000   1st Qu.: 3.75  
 Mode  :character   Median :1.0000   Median : 6.50  
                    Mean   :0.6866   Mean   : 6.50  
                    3rd Qu.:1.0000   3rd Qu.: 9.25  
                    Max.   :1.0000   Max.   :12.00  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># look at the data (can also use summary(), str(), head() etc.)</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(pong_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 4,608
Columns: 8
$ Participant     &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, …
$ JudgedSpeed     &lt;dbl&gt; 1, 0, 1, 0, 1, 0, 1, 0, 0, 0, 1, 1, 0, 1, 0, 1, 0, 1, …
$ PaddleLength    &lt;dbl&gt; 50, 250, 50, 250, 250, 50, 250, 50, 250, 50, 50, 250, …
$ BallSpeed       &lt;dbl&gt; 5, 3, 4, 3, 7, 5, 6, 2, 4, 4, 7, 7, 3, 6, 5, 7, 2, 5, …
$ TrialNumber     &lt;dbl&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16,…
$ BackgroundColor &lt;chr&gt; "red", "blue", "red", "red", "blue", "blue", "red", "r…
$ HitOrMiss       &lt;dbl&gt; 0, 1, 0, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 0, 1, 1, …
$ BlockNumber     &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, …</code></pre>
</div>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>new_pong_data <span class="ot">&lt;-</span> pong_data <span class="sc">%&gt;%</span> </span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(BallSpeed, HitOrMiss, JudgedSpeed, Participant, </span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>         TrialNumber) <span class="sc">%&gt;%</span> </span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(HitOrMiss), <span class="fu">desc</span>(JudgedSpeed)) <span class="sc">%&gt;%</span> </span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(JudgedSpeed <span class="sc">==</span> <span class="dv">1</span>,</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>         BallSpeed <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"2"</span>, <span class="st">"4"</span>, <span class="st">"5"</span>, <span class="st">"7"</span>),</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>         HitOrMiss <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(TrialNumber <span class="sc">&gt;</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">TrialNumber =</span> TrialNumber <span class="sc">-</span><span class="dv">1</span>) </span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># summarize (use old data frame because we removed variables)</span></span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a>pong_data_hits <span class="ot">&lt;-</span> pong_data <span class="sc">%&gt;%</span> </span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(BackgroundColor, </span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a>           PaddleLength) <span class="sc">%&gt;%</span> </span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total_hits =</span> <span class="fu">sum</span>(HitOrMiss, </span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a>                             <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a>            <span class="at">meanhits =</span> <span class="fu">mean</span>(HitOrMiss, </span>
<span id="cb50-18"><a href="#cb50-18" aria-hidden="true" tabindex="-1"></a>                            <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="thanks" class="level2">
<h2 class="anchored" data-anchor-id="thanks">Thanks!</h2>
<p>Learning objectives:</p>
<ul>
<li><p>Learn about tidyverse vs.&nbsp;base R</p></li>
<li><p>Learn and apply the six basic dplyr “verbs”</p></li>
<li><p>Learn how to join data frames</p></li>
</ul>
<p>. . .</p>
<p>Next week:</p>
<p>Data Visualization in R</p>


</section>
</section>

</main> <!-- /main -->
<script>

/* update total correct if #webex-total_correct exists */
update_total_correct = function() {
  console.log("webex: update total_correct");

  var t = document.getElementsByClassName("webex-total_correct");
  for (var i = 0; i < t.length; i++) {
    p = t[i].parentElement;
    var correct = p.getElementsByClassName("webex-correct").length;
    var solvemes = p.getElementsByClassName("webex-solveme").length;
    var radiogroups = p.getElementsByClassName("webex-radiogroup").length;
    var selects = p.getElementsByClassName("webex-select").length;

    t[i].innerHTML = correct + " of " + (solvemes + radiogroups + selects) + " correct";
  }
}

/* webex-solution button toggling function */
b_func = function() {
  console.log("webex: toggle hide");

  var cl = this.parentElement.classList;
  if (cl.contains('open')) {
    cl.remove("open");
  } else {
    cl.add("open");
  }
}

/* check answers */
check_func = function() {
  console.log("webex: check answers");

  var cl = this.parentElement.classList;
  if (cl.contains('unchecked')) {
    cl.remove("unchecked");
    this.innerHTML = "Hide Answers";
  } else {
    cl.add("unchecked");
    this.innerHTML = "Show Answers";
  }
}

/* function for checking solveme answers */
solveme_func = function(e) {
  console.log("webex: check solveme");

  var real_answers = JSON.parse(this.dataset.answer);
  var my_answer = this.value;
  var cl = this.classList;
  if (cl.contains("ignorecase")) {
    my_answer = my_answer.toLowerCase();
  }
  if (cl.contains("nospaces")) {
    my_answer = my_answer.replace(/ /g, "")
  }

  if (my_answer == "") {
    cl.remove("webex-correct");
    cl.remove("webex-incorrect");
  } else if (real_answers.includes(my_answer)) {
    cl.add("webex-correct");
    cl.remove("webex-incorrect");
  } else {
    cl.add("webex-incorrect");
    cl.remove("webex-correct");
  }

  // match numeric answers within a specified tolerance
  if(this.dataset.tol > 0){
    var tol = JSON.parse(this.dataset.tol);
    var matches = real_answers.map(x => Math.abs(x - my_answer) < tol)
    if (matches.reduce((a, b) => a + b, 0) > 0) {
      cl.add("webex-correct");
    } else {
      cl.remove("webex-correct");
    }
  }

  // added regex bit
  if (cl.contains("regex")){
    answer_regex = RegExp(real_answers.join("|"))
    if (answer_regex.test(my_answer)) {
      cl.add("webex-correct");
    }
  }

  update_total_correct();
}

/* function for checking select answers */
select_func = function(e) {
  console.log("webex: check select");

  var cl = this.classList

  /* add style */
  cl.remove("webex-incorrect");
  cl.remove("webex-correct");
  if (this.value == "answer") {
    cl.add("webex-correct");
  } else if (this.value != "blank") {
    cl.add("webex-incorrect");
  }

  update_total_correct();
}

/* function for checking radiogroups answers */
radiogroups_func = function(e) {
  console.log("webex: check radiogroups");

  var checked_button = document.querySelector('input[name=' + this.id + ']:checked');
  var cl = checked_button.parentElement.classList;
  var labels = checked_button.parentElement.parentElement.children;

  /* get rid of styles */
  for (i = 0; i < labels.length; i++) {
    labels[i].classList.remove("webex-incorrect");
    labels[i].classList.remove("webex-correct");
  }

  /* add style */
  if (checked_button.value == "answer") {
    cl.add("webex-correct");
  } else {
    cl.add("webex-incorrect");
  }

  update_total_correct();
}

window.onload = function() {
  console.log("webex onload");
  /* set up solution buttons */
  var buttons = document.getElementsByTagName("button");

  for (var i = 0; i < buttons.length; i++) {
    if (buttons[i].parentElement.classList.contains('webex-solution')) {
      buttons[i].onclick = b_func;
    }
  }

  var check_sections = document.getElementsByClassName("webex-check");
  console.log("check:", check_sections.length);
  for (var i = 0; i < check_sections.length; i++) {
    check_sections[i].classList.add("unchecked");

    let btn = document.createElement("button");
    btn.innerHTML = "Show Answers";
    btn.classList.add("webex-check-button");
    btn.onclick = check_func;
    check_sections[i].appendChild(btn);

    let spn = document.createElement("span");
    spn.classList.add("webex-total_correct");
    check_sections[i].appendChild(spn);
  }

  /* set up webex-solveme inputs */
  var solveme = document.getElementsByClassName("webex-solveme");

  for (var i = 0; i < solveme.length; i++) {
    /* make sure input boxes don't auto-anything */
    solveme[i].setAttribute("autocomplete","off");
    solveme[i].setAttribute("autocorrect", "off");
    solveme[i].setAttribute("autocapitalize", "off");
    solveme[i].setAttribute("spellcheck", "false");
    solveme[i].value = "";

    /* adjust answer for ignorecase or nospaces */
    var cl = solveme[i].classList;
    var real_answer = solveme[i].dataset.answer;
    if (cl.contains("ignorecase")) {
      real_answer = real_answer.toLowerCase();
    }
    if (cl.contains("nospaces")) {
      real_answer = real_answer.replace(/ /g, "");
    }
    solveme[i].dataset.answer = real_answer;

    /* attach checking function */
    solveme[i].onkeyup = solveme_func;
    solveme[i].onchange = solveme_func;

    solveme[i].insertAdjacentHTML("afterend", " <span class='webex-icon'></span>")
  }

  /* set up radiogroups */
  var radiogroups = document.getElementsByClassName("webex-radiogroup");
  for (var i = 0; i < radiogroups.length; i++) {
    radiogroups[i].onchange = radiogroups_func;
  }

  /* set up selects */
  var selects = document.getElementsByClassName("webex-select");
  for (var i = 0; i < selects.length; i++) {
    selects[i].onchange = select_func;
    selects[i].insertAdjacentHTML("afterend", " <span class='webex-icon'></span>")
  }

  update_total_correct();
}

</script>

<script>
  // htmlwidgets need to know to resize themselves when slides are shown/hidden.
  // Fire the "slideenter" event (handled by htmlwidgets.js) when the current
  // slide changes (different for each slide format).
  (function () {
    // dispatch for htmlwidgets
    function fireSlideEnter() {
      const event = window.document.createEvent("Event");
      event.initEvent("slideenter", true, true);
      window.document.dispatchEvent(event);
    }

    function fireSlideChanged(previousSlide, currentSlide) {
      fireSlideEnter();

      // dispatch for shiny
      if (window.jQuery) {
        if (previousSlide) {
          window.jQuery(previousSlide).trigger("hidden");
        }
        if (currentSlide) {
          window.jQuery(currentSlide).trigger("shown");
        }
      }
    }

    // hookup for slidy
    if (window.w3c_slidy) {
      window.w3c_slidy.add_observer(function (slide_num) {
        // slide_num starts at position 1
        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);
      });
    }

  })();
</script>

<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>